<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="formulario.css">
  <title>Altas - Omnipotent Tech</title>
  <style>
    .campo-valido {
      border-color: #28a745 !important;
      background-color: #f8fff9;
    }
    .campo-invalido {
      border-color: #dc3545 !important;
      background-color: #fff8f8;
    }
    .mensaje-error {
      color: #dc3545;
      font-size: 0.875em;
      margin-top: 0.25rem;
      display: none;
    }
    .mensaje-error.mostrar {
      display: block;
    }
    .grupo-campo {
      position: relative;
      margin-bottom: 1rem;
    }
    .preview-imagen {
      display: none;
      margin-top: 10px;
      max-width: 200px;
      border-radius: 10px;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
    }
    .info-archivo {
      font-size: 0.9em;
      margin-top: 5px;
      color: #555;
    }
    .btn-eliminar-imagen {
      background: #dc3545;
      color: #fff;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    .btn-submit:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <header>
    <h1>Altas de Productos y Servicios</h1>
    <nav><a href="index.html">🏠 Inicio</a></nav>
  </header>

  <main>
    <section>
      <h2>Registrar un nuevo producto o servicio</h2>

      <form id="formAltas">
        <!-- Campos -->
        <div class="grupo-campo">
          <label for="nombre">Nombre/Descripción:</label>
          <input type="text" id="nombre" required minlength="3" maxlength="100">
          <div class="mensaje-error" id="error-nombre"></div>
        </div>

        <div class="grupo-campo">
          <label for="categoria">Categoría:</label>
          <input type="text" id="categoria" required>
          <div class="mensaje-error" id="error-categoria"></div>
        </div>

        <div class="grupo-campo">
          <label for="tipo">Tipo:</label>
          <input type="text" id="tipo" required>
          <div class="mensaje-error" id="error-tipo"></div>
        </div>

        <div class="grupo-campo">
          <label for="marca">Marca/Fabricante:</label>
          <input type="text" id="marca" required>
          <div class="mensaje-error" id="error-marca"></div>
        </div>

        <div class="grupo-campo">
          <label for="proveedor">Proveedor:</label>
          <input type="text" id="proveedor" required>
          <div class="mensaje-error" id="error-proveedor"></div>
        </div>

        <div class="grupo-campo">
          <label for="stock">Cantidad en Stock:</label>
          <input type="number" id="stock" required min="0" max="100000">
          <div class="mensaje-error" id="error-stock"></div>
        </div>

        <div class="grupo-campo">
          <label for="precio">Precio Unitario:</label>
          <input type="number" id="precio" required min="0.01" step="0.01">
          <div class="mensaje-error" id="error-precio"></div>
        </div>

        <div class="grupo-campo">
          <label for="fecha">Fecha de Ingreso:</label>
          <input type="date" id="fecha" required>
          <div class="mensaje-error" id="error-fecha"></div>
        </div>

        <div class="grupo-campo">
          <label for="estado">Estado:</label>
          <select id="estado" required>
            <option value="">Seleccione una opción</option>
            <option value="Disponible">Disponible</option>
            <option value="Bajo Stock">Bajo Stock</option>
            <option value="Agotado">Agotado</option>
          </select>
          <div class="mensaje-error" id="error-estado"></div>
        </div>

        <!-- Imagen -->
        <div class="grupo-campo">
          <label for="imagen">Imagen del Producto:</label>
          <div id="area-carga-imagen">
            <button type="button" id="btn-seleccionar-imagen" class="btn-submit">Seleccionar Imagen</button>
            <input type="file" id="imagen" accept="image/*" style="display:none;">
            <img id="preview-imagen" class="preview-imagen" alt="Vista previa">
            <div id="info-archivo" class="info-archivo"></div>
            <button type="button" id="btn-eliminar-imagen" class="btn-eliminar-imagen">Eliminar Imagen</button>
          </div>
          <div class="mensaje-error" id="error-imagen">La imagen es obligatoria</div>
        </div>

        <button type="submit" id="btn-submit" class="btn-submit">Guardar Producto</button>
        <button type="reset" id="btn-reset">Limpiar Formulario</button>
      </form>
    </section>
  </main>

  <footer>
    <p>Omnipotent Tech © 2025 - Todos los derechos reservados</p>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/validator/13.12.0/validator.min.js"></script>
  <script>
    const form = document.getElementById('formAltas');
    const inputImagen = document.getElementById('imagen');
    const previewImagen = document.getElementById('preview-imagen');
    const infoArchivo = document.getElementById('info-archivo');
    const errorImagen = document.getElementById('error-imagen');
    const btnSeleccionarImagen = document.getElementById('btn-seleccionar-imagen');
    const btnEliminarImagen = document.getElementById('btn-eliminar-imagen');
    const btnReset = document.getElementById('btn-reset');
    let imagenCargada = false;

    // Fecha máxima = hoy
    const fechaInput = document.getElementById('fecha');
    const hoy = new Date().toISOString().split('T')[0];
    fechaInput.setAttribute('max', hoy);

    // --- Manejo de Imagen ---
    btnSeleccionarImagen.addEventListener('click', () => inputImagen.click());

    inputImagen.addEventListener('change', () => {
      const archivo = inputImagen.files[0];
      if (!archivo) return;

      if (archivo.size > 5 * 1024 * 1024) {
        alert('Tamaño máximo permitido: 5MB');
        limpiarImagen();
        return;
      }

      const lector = new FileReader();
      lector.onload = e => {
        previewImagen.src = e.target.result;
        previewImagen.style.display = 'block';
        infoArchivo.textContent = `Archivo: ${archivo.name} (${(archivo.size / 1024).toFixed(1)} KB)`;
        imagenCargada = true;
        errorImagen.classList.remove('mostrar');
      };
      lector.readAsDataURL(archivo);
    });

    btnEliminarImagen.addEventListener('click', limpiarImagen);
    btnReset.addEventListener('click', limpiarImagen);

    function limpiarImagen() {
      inputImagen.value = '';
      previewImagen.src = '';
      previewImagen.style.display = 'none';
      infoArchivo.textContent = '';
      imagenCargada = false;
    }

    // --- Validación al enviar ---
    form.addEventListener('submit', e => {
      e.preventDefault();

      if (!imagenCargada) {
        alert('Debe seleccionar una imagen antes de enviar.');
        errorImagen.classList.add('mostrar');
        return;
      }

      alert('Producto registrado correctamente');
      form.reset();
      limpiarImagen();
      document.querySelectorAll('.campo-valido').forEach(c => c.classList.remove('campo-valido'));
    });
  </script>
</body>
</html>
